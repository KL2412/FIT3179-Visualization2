{
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
  "width": 1000,
  "height": 400,
  "data": {
    "url": "Dataset/athletes.csv"
  },
  "transform": [
    {
      "calculate": "replace(replace(datum.disciplines, '\\[\\'', ''), '\\'\\]', '')",
      "as": "clean_disciplines"
    },
    {
      "calculate": "2024 - year(datum.birth_date)",
      "as": "age"
    },
    {
      "aggregate": [
        {"op": "min", "field": "age", "as": "youngest_age"},
        {"op": "max", "field": "age", "as": "oldest_age"},
        {"op": "mean", "field": "age", "as": "avg_age"}
      ],
      "groupby": ["clean_disciplines"]
    },
    {
      "window": [{"op": "min", "field": "youngest_age", "as": "global_youngest_age"}],
      "frame": [null, null]
    },
    {
      "window": [{"op": "max", "field": "oldest_age", "as": "global_oldest_age"}],
      "frame": [null, null]
    }
  ],
  "layer": [
    {
      "mark": {
        "type": "rule",
        "color": "lightgray"
      },
      "encoding": {
        "x": {
          "field": "clean_disciplines",
          "type": "nominal",
          "axis": {
            "title": "Sport Category",
            "labelAngle": 45,
            "labelFontSize": 16,
            "titleFontSize": 20
          }
        },
        "y": {
          "field": "youngest_age",
          "type": "quantitative",
          "axis": {
            "title": "Age",
            "labelFontSize": 16,
            "titleFontSize": 20,
            "grid": false
          }
        },
        "y2": {
          "field": "oldest_age"
        }
      }
    },
    {
      "mark": {
        "type": "circle",
        "color": "gold",
        "size": 100
      },
      "encoding": {
        "x": {
          "field": "clean_disciplines",
          "type": "nominal"
        },
        "y": {
          "field": "youngest_age",
          "type": "quantitative"
        },
        "tooltip": [
          {"field": "clean_disciplines", "type": "nominal", "title": "Sport"},
          {"field": "youngest_age", "type": "quantitative", "title": "Youngest Age"}
        ]
      }
    },
    {
      "mark": {
        "type": "circle",
        "color": "black",
        "size": 100
      },
      "encoding": {
        "x": {
          "field": "clean_disciplines",
          "type": "nominal"
        },
        "y": {
          "field": "avg_age",
          "type": "quantitative"
        },
        "tooltip": [
          {"field": "clean_disciplines", "type": "nominal", "title": "Sport"},
          {"field": "avg_age", "type": "quantitative", "title": "Average Age", "format": ".2f"}
        ]
      }
    },
    {
      "mark": {
        "type": "circle",
        "color": "orange",
        "size": 100
      },
      "encoding": {
        "x": {
          "field": "clean_disciplines",
          "type": "nominal"
        },
        "y": {
          "field": "oldest_age",
          "type": "quantitative"
        },
        "tooltip": [
          {"field": "clean_disciplines", "type": "nominal", "title": "Sport"},
          {"field": "oldest_age", "type": "quantitative", "title": "Oldest Age"}
        ]
      }
    },
    {
      "mark": {"type": "text", "color": "red", "fontSize": 14, "align": "left", "dx": -50, "dy": 15},
      "transform": [{"filter": "datum.oldest_age == datum.global_oldest_age"}],
      "encoding": {
        "x": {"field": "clean_disciplines", "type": "nominal"},
        "y": {"field": "oldest_age", "type": "quantitative"},
        "text": {"value": "Oldest Olympian"}
      }
    },
    {
      "mark": {"type": "text", "color": "red", "fontSize": 14, "align": "left", "dx": -60, "dy": 15},
      "transform": [{"filter": "datum.youngest_age == datum.global_youngest_age"}],
      "encoding": {
        "x": {"field": "clean_disciplines", "type": "nominal"},
        "y": {"field": "youngest_age", "type": "quantitative"},
        "text": {"value": "Youngest Olympian"}
      }
    }
  ]
}
